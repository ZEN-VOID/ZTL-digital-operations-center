# E2å›¾ç”Ÿå›¾æ‰§è¡Œè®¡åˆ’ç›®å½•

> E2æ™ºèƒ½ä½“(é¤é¥®å›¾ç”Ÿå›¾AIGC)çš„JSONæ‰§è¡Œè®¡åˆ’å­˜å‚¨ç›®å½•ï¼Œæ”¯æŒå›¾ç‰‡ä¼˜åŒ–ã€é£æ ¼è¿ç§»ã€å±€éƒ¨ç¼–è¾‘ç­‰å¤šç§å›¾ç‰‡å¤„ç†ä»»åŠ¡ã€‚

## ğŸ“‹ ç›®å½•æ¦‚è¿°

å­˜å‚¨E2æ™ºèƒ½ä½“çš„æ‰§è¡Œè®¡åˆ’æ–‡ä»¶ï¼Œé€šè¿‡æ ‡å‡†åŒ–çš„JSONæ ¼å¼å®šä¹‰å›¾ç”Ÿå›¾ä»»åŠ¡ï¼Œæ”¯æŒåŸºäºåŸå›¾çš„ä¸“ä¸šçº§å›¾ç‰‡å¤„ç†å’Œåˆ›æ„ç¼–è¾‘ã€‚

## ğŸ¯ E2æ™ºèƒ½ä½“èƒ½åŠ›

**æ ¸å¿ƒåŠŸèƒ½**: å›¾ç‰‡ç”Ÿæˆå›¾ç‰‡(Image-to-Image)
**ä¸“ä¸šé¢†åŸŸ**: é¤é¥®å›¾ç‰‡ä¼˜åŒ–ã€é£æ ¼è½¬æ¢ã€å±€éƒ¨ç¼–è¾‘
**è¾“å‡ºè´¨é‡**: ä¿æŒåŸå›¾åˆ†è¾¨ç‡æˆ–æ›´é«˜ï¼ŒPNGæ ¼å¼

**ä¸‰å¤§æ“ä½œç±»å‹**:
1. **optimization** - å›¾ç‰‡ä¼˜åŒ–å¢å¼º
2. **style_transfer** - é£æ ¼è¿ç§»è½¬æ¢
3. **local_edit** - å±€éƒ¨å…ƒç´ ç¼–è¾‘

## ğŸ“ æ–‡ä»¶ç±»å‹

### template.json - æ ‡å‡†æ¨¡æ¿
**ä½œç”¨**: æä¾›E2æ‰§è¡Œè®¡åˆ’çš„æ ‡å‡†æ ¼å¼
**åŒ…å«**: operation_typeã€image_urlã€text_promptç­‰å­—æ®µç¤ºä¾‹

### task-*.json - ç”¨æˆ·ä»»åŠ¡
**å‘½åæ ¼å¼**: `task-[åºå·]-[æ“ä½œç±»å‹]-[æè¿°].json`
**ç¤ºä¾‹**: `task-001-dish-style-transfer.json`

### [é¡¹ç›®å]-*.json - ä¸“é¡¹ä»»åŠ¡
**å‘½åæ ¼å¼**: `[é¡¹ç›®]-[æ“ä½œ]-[æ—¥æœŸ].json`
**ç¤ºä¾‹**: `houxiang-baozi-poster-redesign-20251011.json`

## ğŸ“ JSONæ‰§è¡Œè®¡åˆ’æ ‡å‡†æ ¼å¼

```json
{
  "agent_id": "E2",
  "task_description": "ä»»åŠ¡æè¿°",
  "input_data": {
    "image_url": "åŸå§‹å›¾ç‰‡è·¯å¾„",
    "operation_type": "optimization|style_transfer|local_edit",
    "text_prompt": "æŒ‡å¯¼æ–‡å­—",
    "edit_config": {
      "edit_areas": [
        {
          "target": "ç¼–è¾‘ç›®æ ‡",
          "modification": "ä¿®æ”¹å†…å®¹",
          "requirement": "è¦æ±‚è¯´æ˜"
        }
      ]
    }
  },
  "output_settings": {
    "save_path": "output/images/2-image-processing/[å­ç›®å½•]/",
    "format": "png",
    "quality": 95
  },
  "metadata": {
    "created_at": "2025-10-11T15:00:00",
    "created_by": "åˆ›å»ºè€…",
    "version": "1.0"
  }
}
```

## ğŸ”§ input_dataå­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| image_url | string | âœ… | åŸå§‹å›¾ç‰‡è·¯å¾„(ç›¸å¯¹é¡¹ç›®æ ¹ç›®å½•) |
| operation_type | string | âœ… | æ“ä½œç±»å‹(optimization/style_transfer/local_edit) |
| text_prompt | string | âŒ | æ–‡å­—æŒ‡å¯¼(å¯ä»edit_configè‡ªåŠ¨ç”Ÿæˆ) |
| edit_config | object | âŒ | å±€éƒ¨ç¼–è¾‘é…ç½®(local_editæ—¶ä½¿ç”¨) |
| operation_params | object | âŒ | æ“ä½œç‰¹å®šå‚æ•° |

## ğŸ¨ æ“ä½œç±»å‹è¯¦è§£

### 1. optimization - å›¾ç‰‡ä¼˜åŒ–

**é€‚ç”¨åœºæ™¯**:
- æå‡å›¾ç‰‡æ¸…æ™°åº¦å’Œç»†èŠ‚
- å¢å¼ºè‰²å½©é¥±å’Œåº¦
- ä¿®å¤å›¾ç‰‡ç‘•ç–µ
- ä¼˜åŒ–å…‰çº¿å’Œå¯¹æ¯”åº¦

**é…ç½®ç¤ºä¾‹**:
```json
{
  "operation_type": "optimization",
  "text_prompt": "å¢å¼ºå›¾ç‰‡æ¸…æ™°åº¦ï¼Œä¼˜åŒ–è‰²å½©ï¼Œæå‡æ•´ä½“è´¨é‡"
}
```

**è¾“å‡ºç›®å½•**: `output/images/2-image-processing/optimization/`

### 2. style_transfer - é£æ ¼è¿ç§»

**é€‚ç”¨åœºæ™¯**:
- å°†ç…§ç‰‡è½¬ä¸ºè‰ºæœ¯é£æ ¼
- åº”ç”¨ç‰¹å®šè§†è§‰é£æ ¼
- æ”¹å˜å›¾ç‰‡æ•´ä½“æ°›å›´
- å“ç‰Œé£æ ¼ç»Ÿä¸€

**é…ç½®ç¤ºä¾‹**:
```json
{
  "operation_type": "style_transfer",
  "text_prompt": "å°†è¿™å¼ èœå“å›¾è½¬æ¢ä¸ºæ°´å½©ç”»é£æ ¼ï¼Œä¿æŒé£Ÿç‰©çš„ä¸»ä½“ç‰¹å¾"
}
```

**è¾“å‡ºç›®å½•**: `output/images/2-image-processing/style_transfer/`

### 3. local_edit - å±€éƒ¨ç¼–è¾‘

**é€‚ç”¨åœºæ™¯**:
- Logoæ›¿æ¢å’Œä¿®æ”¹
- æ–‡å­—å†…å®¹æ›´æ–°
- é…è‰²è°ƒæ•´
- å…ƒç´ æ·»åŠ æˆ–åˆ é™¤

**é…ç½®ç¤ºä¾‹**:
```json
{
  "operation_type": "local_edit",
  "text_prompt": "ä¿®æ”¹Logoä¸ºæ–°å“ç‰Œåç§°ï¼Œè°ƒæ•´èƒŒæ™¯è‰²ä¸ºè“è‰²",
  "edit_config": {
    "edit_areas": [
      {
        "target": "Logoæ–‡å­—",
        "modification": "æ›¿æ¢ä¸º'NEW BRAND'",
        "requirement": "ä¿æŒLogoä½ç½®å’Œå¤§å°ä¸å˜"
      },
      {
        "target": "èƒŒæ™¯è‰²",
        "modification": "æ”¹ä¸ºæ·±è“è‰²",
        "requirement": "ä¿æŒè§†è§‰å±‚æ¬¡å’Œå¯¹æ¯”åº¦"
      }
    ]
  }
}
```

**è¾“å‡ºç›®å½•**: `output/images/2-image-processing/local_edit/`

## ğŸš€ ä½¿ç”¨æµç¨‹

### åˆ›å»ºæ–°ä»»åŠ¡

**æ­¥éª¤1**: å‡†å¤‡åŸå§‹å›¾ç‰‡
```bash
# ç¡®ä¿å›¾ç‰‡å­˜åœ¨äºé¡¹ç›®ä¸­
ls -la input/é¡¹ç›®å/å›¾ç‰‡.jpg
```

**æ­¥éª¤2**: å¤åˆ¶æ¨¡æ¿å¹¶ç¼–è¾‘
```bash
cp api/plans/e2-image-to-image/template.json \
   api/plans/e2-image-to-image/task-002-my-edit.json

# ç¼–è¾‘JSONæ–‡ä»¶ï¼Œå¡«å†™:
# - image_url: åŸå›¾è·¯å¾„
# - operation_type: æ“ä½œç±»å‹
# - text_prompt: ç¼–è¾‘æŒ‡å¯¼
```

**æ­¥éª¤3**: æ‰§è¡Œä»»åŠ¡
```bash
python api/projects/nano-banana-api/execute_plan.py \
  --plan api/plans/e2-image-to-image/task-002-my-edit.json
```

**æ­¥éª¤4**: æŸ¥çœ‹ç»“æœ
- æ ¹æ®operation_typeæŸ¥æ‰¾å¯¹åº”è¾“å‡ºç›®å½•
- æ–‡ä»¶åæ ¼å¼: `[operation_type]_YYYYMMDDHHmmss_1.png`

## ğŸ’¡ text_promptç¼–å†™æŠ€å·§

### local_editçš„promptæ„å»º

**æ–¹æ³•1: æ‰‹åŠ¨ç¼–å†™**
```json
"text_prompt": "ä¿®æ”¹Logoä¸ºHOUXIANG BAOZIï¼ŒèƒŒæ™¯æ”¹ä¸ºè“è‰²ï¼ŒåŒ…å­æ”¹ä¸ºç™½è‰²ç²‰ç¬”è´¨æ„Ÿ"
```

**æ–¹æ³•2: ä»edit_configè‡ªåŠ¨ç”Ÿæˆ**
```json
"edit_config": {
  "edit_areas": [
    {"target": "Logo", "modification": "HOUXIANG BAOZI"},
    {"target": "èƒŒæ™¯", "modification": "è“è‰²"},
    {"target": "åŒ…å­", "modification": "ç™½è‰²ç²‰ç¬”è´¨æ„Ÿ"}
  ]
}
// execute_plan.pyä¼šè‡ªåŠ¨ç”Ÿæˆ: "Logo: HOUXIANG BAOZI; èƒŒæ™¯: è“è‰²; åŒ…å­: ç™½è‰²ç²‰ç¬”è´¨æ„Ÿ"
```

### optimizationçš„promptå»ºè®®

```
å¢å¼ºè¿™å¼ [èœå“/æµ·æŠ¥]å›¾ç‰‡çš„æ•´ä½“è´¨é‡ï¼š
- æå‡æ¸…æ™°åº¦å’Œç»†èŠ‚è¡¨ç°
- ä¼˜åŒ–è‰²å½©é¥±å’Œåº¦å’Œå¯¹æ¯”åº¦
- å¢å¼ºå…‰çº¿æ•ˆæœ
- ä¿æŒåŸå›¾æ„å›¾å’Œä¸»ä½“ç‰¹å¾
```

### style_transferçš„promptå»ºè®®

```
å°†è¿™å¼ å›¾ç‰‡è½¬æ¢ä¸º[é£æ ¼åç§°]é£æ ¼ï¼š
- ä¿æŒä¸»ä½“å…ƒç´ ä¸å˜
- åº”ç”¨[é£æ ¼]çš„è§†è§‰ç‰¹å¾
- ä¿è¯è½¬æ¢åçš„å¯è¯†åˆ«æ€§
- é€‚åˆ[ç”¨é€”]ä½¿ç”¨
```

## ğŸ” ä»»åŠ¡ç¤ºä¾‹åˆ†æ

### ç¤ºä¾‹1: å¼å··åŒ…å­æµ·æŠ¥é‡è®¾è®¡

**æ–‡ä»¶**: `houxiang-baozi-poster-redesign-20251011.json`

**ä»»åŠ¡æè¿°**: ä¿®æ”¹å¼å··æµ·æŠ¥ - æ›´æ¢Logo + è“åº•é…è‰² + ç™½è‰²ç²‰ç¬”è´¨æ„Ÿ

**å…³é”®é…ç½®**:
```json
{
  "operation_type": "local_edit",
  "text_prompt": "ä¿®æ”¹è¿™å¼ æµ·æŠ¥è®¾è®¡ï¼Œä¿æŒæ•´ä½“æ„å›¾å’Œç‰ˆå¼ä¸å˜ï¼Œè¿›è¡Œä»¥ä¸‹è°ƒæ•´ï¼š
1. å°†Logoæ–‡å­—æ›¿æ¢ä¸º'HOUXIANG BAOZI'
2. å°†èƒŒæ™¯è‰²æ”¹ä¸ºæ·±è“è‰²è°ƒ
3. å°†åŒ…å­éƒ¨åˆ†æ”¹ä¸ºç™½è‰²ç²‰ç¬”æ‰‹ç»˜è´¨æ„Ÿæ•ˆæœ
4. ä¿æŒæµ·æŠ¥çš„æ•´ä½“é£æ ¼å’Œè®¾è®¡æ„Ÿ
5. ç¡®ä¿æ–‡å­—æ¸…æ™°å¯è¯»ï¼Œè§†è§‰å±‚æ¬¡åˆ†æ˜",
  "edit_config": {
    "edit_areas": [
      {
        "target": "Logoæ–‡å­—",
        "modification": "æ›¿æ¢ä¸º'HOUXIANG BAOZI'",
        "requirement": "ä¿æŒLogoçš„ä½ç½®ã€å¤§å°å’Œé£æ ¼"
      },
      // ... å…¶ä»–ç¼–è¾‘åŒºåŸŸ
    ]
  }
}
```

**è®¾è®¡è¦ç‚¹**:
- ä½¿ç”¨è¯¦ç»†çš„text_promptæŒ‡å¯¼ç¼–è¾‘
- edit_configæä¾›ç»“æ„åŒ–çš„ç¼–è¾‘è¦æ±‚
- å¤šä¸ªç¼–è¾‘åŒºåŸŸååŒå¤„ç†

### ç¤ºä¾‹2: èœå“é£æ ¼è¿ç§»

**æ–‡ä»¶**: `task-001-dish-style-transfer.json`

**ä»»åŠ¡æè¿°**: å°†èœå“å›¾è½¬æ¢ä¸ºè‰ºæœ¯é£æ ¼

**æ“ä½œç±»å‹**: style_transfer

## âš ï¸ å¸¸è§é—®é¢˜

### Q1: image_urlè·¯å¾„é”™è¯¯
**é”™è¯¯**: `FileNotFoundError: image not found`
**è§£å†³**: ä½¿ç”¨é¡¹ç›®ç›¸å¯¹è·¯å¾„ï¼Œå¦‚`input/å¼å··/è®¾è®¡/æµ·æŠ¥/1.jpg`

### Q2: operation_typeä¸æ­£ç¡®
**é”™è¯¯**: `ValueError: invalid operation_type`
**è§£å†³**: åªèƒ½ä½¿ç”¨optimization/style_transfer/local_editä¸‰ç§

### Q3: text_promptä¸ºç©ºä½†edit_configä¹Ÿä¸ºç©º
**è§£å†³**: local_editå¿…é¡»æä¾›text_promptæˆ–edit_configä¹‹ä¸€

### Q4: è¾“å‡ºè´¨é‡ä¸ç†æƒ³
**è§£å†³**:
- å¢å¼ºtext_promptçš„è¯¦ç»†ç¨‹åº¦
- ä½¿ç”¨edit_configæä¾›ç»“æ„åŒ–è¦æ±‚
- å°è¯•è°ƒæ•´operation_paramså‚æ•°

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [E2æ™ºèƒ½ä½“æ–‡æ¡£](../../../.claude/agents/E2.md)
- [ç»Ÿä¸€æ‰§è¡Œå™¨æ–‡æ¡£](../../projects/nano-banana-api/README.md)
- [execute_plan.pyå‚æ•°æ˜ å°„](../../projects/nano-banana-api/execute_plan.py#L59-L79)
- [è¾“å‡ºç›®å½•è¯´æ˜](../../../output/images/README.md#2-e2å›¾ç”Ÿå›¾è¾“å‡º-2-image-processing)

## ğŸ“Š æœ€ä½³å®è·µ

**ä»»åŠ¡è§„åˆ’**:
- æ˜ç¡®æ“ä½œç±»å‹(optimization/style_transfer/local_edit)
- å‡†å¤‡é«˜è´¨é‡åŸå›¾(åˆ†è¾¨ç‡è¶Šé«˜æ•ˆæœè¶Šå¥½)
- è¯¦ç»†æè¿°ç¼–è¾‘éœ€æ±‚

**é…ç½®ç¼–å†™**:
- local_editä¼˜å…ˆä½¿ç”¨edit_configç»“æ„åŒ–é…ç½®
- text_promptåº”å…·ä½“ã€å¯æ‰§è¡Œ
- ä¿æŒJSONæ ¼å¼æ­£ç¡®æ€§

**è´¨é‡æ§åˆ¶**:
- å¯¹æ¯”åŸå›¾å’Œç”Ÿæˆç»“æœ
- è®°å½•æˆåŠŸçš„promptæ¨¡æ¿
- è¿­ä»£ä¼˜åŒ–é…ç½®å‚æ•°

**ç‰ˆæœ¬ç®¡ç†**:
- é‡è¦ä»»åŠ¡ä½¿ç”¨é¡¹ç›®å-æ—¥æœŸå‘½å
- ä¿ç•™ç¼–è¾‘å†å²JSONæ–‡ä»¶
- è®°å½•å‚æ•°è°ƒæ•´è¿‡ç¨‹

---

**ç›®å½•ç‰ˆæœ¬**: v1.0.0
**åˆ›å»ºæ—¥æœŸ**: 2025-10-11
**æ™ºèƒ½ä½“**: E2 - é¤é¥®å›¾ç”Ÿå›¾AIGCæ™ºèƒ½ä½“
**æ‰§è¡Œå™¨**: api/projects/nano-banana-api/execute_plan.py
**å‚æ•°æ˜ å°„**: Lines 59-79 (E2ä¸“ç”¨é€»è¾‘)
