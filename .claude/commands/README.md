# 📋 指令三层架构系统

> 基于"智能理解+配置驱动+自动执行"的命令系统框架,通过模块化命令家族和标准化执行模式,实现从自然语言到自动化操作的全流程智能化。命令系统支持灵活扩展和定制化配置。

---

## 🏗️ 核心架构范式

### 三层架构设计理念

**核心思想**: 将复杂的自动化任务分解为三个清晰的层次,实现关注点分离和职责解耦

```yaml
规范·计划·执行三层架构:
  第1层 - 规范层 (指令定义):
    职责: 指令定义、指令规则、指令SOP
    核心能力: 自然语言理解、意图识别、参数推断
    特点: 用户友好、智能化、标准化
    输出: 执行计划

  第2层 - 计划层 (执行配置):
    职责: 细节的执行计划
    核心能力: 存储执行参数、任务配置、状态管理
    特点: 配置与代码分离、可复用、可追溯
    输出: 结构化任务计划(JSON/YAML)

  第3层 - 执行层 (脚本执行):
    职责: 针对特定计划的脚本执行
    核心能力: 读取计划、执行核心逻辑、返回结果
    特点: 单一职责、独立测试、高性能
    输出: 执行结果和状态反馈
```

### 三层架构优势

```yaml
优势1 - 配置与代码分离:
  - ✅ 配置文件可复用、可追溯
  - ✅ 同一脚本处理不同任务
  - ✅ 便于版本控制和团队协作

优势2 - 执行效率高:
  - ✅ 直接执行,无需中间层转换
  - ✅ 批量处理性能优异
  - ✅ 支持并行和异步执行

优势3 - 智能化程度高:
  - ✅ 自然语言理解用户意图
  - ✅ 自动生成配置文件
  - ✅ 智能推断参数和路径

优势4 - 可维护性强:
  - ✅ 单一职责,逻辑清晰
  - ✅ 独立测试,质量保证
  - ✅ 易于扩展和优化
```

---

## 📊 命令分类体系

### 🏗️ 命令家族分类

命令按功能领域和应用场景分为多个家族,每个家族服务特定的开发需求:

```yaml
命令生态系统:
  上下文管理类 (Context):
    定位: 记忆管理、状态控制、知识沉淀
    特点: 文档驱动、有机生长、持续演进
    快捷键: /C, /V, /X, /Z
    数量: 4个核心命令

  学习迭代类 (Learning):
    定位: 知识获取、能力提升、系统化学习
    特点: ASDW系统、结构化、实践导向
    快捷键: /A, /D, /S, /W
    数量: 4个核心命令

  系统管理类 (System):
    定位: 配置管理、文档生成、基础设施
    特点: 元能力、自动化、标准化
    快捷键: /B, /E, /F, /G, /H, /I, /M, /N, /O, /P, /Q, /R, /U, /Y
    数量: 14个核心命令

  任务执行类 (Task):
    定位: 具体任务的自动化执行
    特点: 三层架构、配置驱动、业务定制
    快捷键: /1-/9
    数量: 可根据项目需求灵活扩展
```

---

## 🎮 命令调用方式

### 📋 通用调用模式

所有命令都支持以下标准调用方式:

```yaml
快捷键调用:
  格式: /[命令标识]
  示例: /G, /U, /M
  说明: 直接执行指定命令

参数化调用:
  格式: /[命令标识] [参数]
  示例: /C 记录重要结论
  说明: 传递具体参数给命令

自然语言调用:
  格式: 执行[命令名称][任务描述]
  示例: 执行GitHub同步推送最新代码
  说明: 通过自然语言描述任务
```

### 🔄 组合调用模式

命令可以组合使用,实现复杂的工作流:

```yaml
顺序执行:
  模式: /A → /S → /D → /W
  说明: 按照ASDW学习系统顺序执行

并行执行:
  模式: /R 并行任务1 任务2 任务3
  说明: 通过/R引擎实现多任务并行

链式执行:
  模式: /命令1 && /命令2 && /命令3
  说明: 前一个成功后执行下一个
```

---

## 📁 核心命令清单

### Context类 - 上下文管理

| 命令         | 名称           | 核心能力                       | 应用场景     |
| ------------ | -------------- | ------------------------------ | ------------ |
| **/C** | 注意力控制系统 | FOCUS/TODO/PROCESS管理         | 记录关键信息 |
| **/V** | 上下文压缩     | 上下文优化、记忆压缩、去重优化 | 优化存储     |
| **/X** | 错误修复记录   | 错误捕获、修复追踪             | 问题诊断     |
| **/Z** | 操作经验记录   | 经验沉淀、最佳实践             | 知识管理     |

### Learning类 - 学习迭代

| 命令         | 名称      | 核心能力           | 应用场景 |
| ------------ | --------- | ------------------ | -------- |
| **/A** | know-what | 现状考察、目标识别 | 了解事物 |
| **/D** | know-how  | 方法制定、实践指南 | 掌握方法 |
| **/S** | know-why  | 原因分析、原理理解 | 理解原理 |
| **/W** | 融会贯通  | 知识整合、能力提升 | 综合应用 |

### System类 - 系统管理

| 命令         | 名称           | 核心能力                 | 应用场景 |
| ------------ | -------------- | ------------------------ | -------- |
| **/B** | 机器级配置更新 | 机器级CLAUDE.md同步      | 全局配置 |
| **/E** | PRP任务流      | 研究→规划→执行         | 复杂任务 |
| **/F** | Create PRP     | PRP文档生成              | 需求规划 |
| **/G** | GitHub同步     | Git推送、仓库同步        | 代码同步 |
| **/H** | GitHub创建     | 仓库创建、初始化         | 新建仓库 |
| **/I** | 根README更新   | 主README生成、项目入口文档 | 项目文档 |
| **/M** | 项目级配置更新 | 项目级CLAUDE.md同步      | 项目配置 |
| **/N** | 用户级配置更新 | 用户级CLAUDE.md同步      | 个人配置 |
| **/O** | 项目概览生成   | OVERVIEW.md深度文档生成  | 技术文档 |
| **/P** | 项目跨区同步   | 跨工作区同步             | 多区域   |
| **/Q** | 上下文感知     | 上下文分析、智能推断     | 环境分析 |
| **/R** | 并行任务执行   | Worktree并行、多方案探索 | 并行处理 |
| **/U** | Trees快照管理  | 目录树快照生成与管理     | 快照管理 |
| **/Y** | Issue修复      | GitHub Issue处理         | 问题解决 |

---

## 🚀 使用指南

### 快速开始

1. **使用上下文命令**:

   ```bash
   /C 记录重要结论
   /X 记录错误和修复
   /Z 记录操作经验
   ```
2. **使用学习命令**:

   ```bash
   /A  # 了解是什么
   /S  # 理解为什么
   /D  # 掌握如何做
   /W  # 融会贯通
   ```
3. **使用系统命令**:

   ```bash
   /G  # GitHub同步
   /U  # 更新README
   /M  # 同步配置
   ```

### 最佳实践

```yaml
设计原则:
  - 单一职责: 每个命令专注一个功能
  - 接口标准: 使用统一的调用方式
  - 文档完整: 提供清晰的使用说明

扩展指南:
  - 使用slash-command-creator agent创建新命令
  - 遵循三层架构规范
  - 编写详细的配置说明

组合模式:
  - 优先使用顺序执行(简单清晰)
  - 复杂任务使用并行执行(提升效率)
  - 必要时使用链式执行(流程控制)
```

---

## 📚 相关文档

- **智能体系统**: `.claude/agents/README.md` - 智能体生态系统架构
- **快捷键系统**: `CLAUDE.md` - 完整的快捷键和意图映射
- **项目概览生成**: `.claude/commands/O.md` - 项目OVERVIEW.md生成指南
- **命令创建**: `.claude/agents/system/Slash-Command-Creator.md` - slash command创建指南

---

## 📝 重要更新说明 (v3.0.0 - 2025-10-20)

### I/U/O命令重构

为了更好地组织文档生成和管理功能,I/U/O三个命令进行了重新设计:

```yaml
重构内容:
  /I - 根README更新:
    - 原功能: 子目录README生成 (已迁移到新/U)
    - 新功能: 项目根README.md生成
    - 定位: 项目入口文档,面向新用户
    - 版本: v3.0.0

  /U - Trees快照管理:
    - 原功能: 主README生成 (已迁移到新/I)
    - 新功能: trees/目录快照生成与管理
    - 定位: Git worktree快照,支持/R并行执行
    - 版本: v3.0.0

  /O - 项目概览生成:
    - 原功能: 元指令-创建commands (已迁移到slash-command-creator agent)
    - 新功能: 项目OVERVIEW.md深度文档生成
    - 定位: 技术文档,面向开发者和维护者
    - 版本: v3.0.0

迁移指南:
  - 创建新命令: 不再使用/O,直接描述需求即可自动调用slash-command-creator agent
  - 更新主README: 使用/I替代原来的/U
  - 更新子README: trees/快照功能已整合,使用/U管理快照
  - 生成技术文档: 使用新的/O生成OVERVIEW.md
```

---

*本文档描述通用的命令架构设计,具体命令可根据项目需求定制扩展*
