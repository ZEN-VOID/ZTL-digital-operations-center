---
name: "Links - Cross-Workspace Sync (Create or Overwrite)"
description: "⚠️ 跨工作区同步 - 基于相对路径的新增或覆盖操作。目标路径不存在则新增，已存在则完全替换。非合并式操作。基于linked-workspace.yaml配置自动识别并批量同步到所有关联工作区。"
allowed-tools: Read, Write, Edit, Bash, Grep, Glob
argument-hint: "<相对路径1> [相对路径2] [...] [--参数]"
version: "4.1.0"
last_updated: "2025-01-27"
category: "system"
type: "transitive"
usage: "/links <相对路径1> [相对路径2] [...] [--参数]"
dependencies: []
---

# 📋 指令概述

## 核心定位
**links命令是基于相对路径的跨工作区同步工具**，通过`.claude/configs/linked-workspace.yaml`配置文件自动识别所有关联工作区，实现文件/文件夹的**新增或覆盖式批量同步**操作。

## ⚠️ 核心机制：基于相对路径的精确同步

**同步行为**：
- **同步对象**：指定的相对路径（文件或文件夹）
- **目标位置**：其他工作区的相同相对路径
- **操作逻辑**：
  - 如果目标路径**不存在** → **新增**（创建文件/文件夹）
  - 如果目标路径**已存在** → **覆盖**（完全替换内容）

**覆盖粒度示例**：

```bash
# 示例1：同步单个文件
/links xx文件夹/yy文件
# 行为：
# - 目标：其他工作区的 xx文件夹/yy文件
# - 不存在 → 新增该文件
# - 已存在 → 完全替换该文件内容
# - 注意：xx文件夹内的其他文件不受影响

# 示例2：同步整个文件夹
/links xx文件夹
# 行为：
# - 目标：其他工作区的 xx文件夹
# - 不存在 → 新增整个文件夹及其所有内容
# - 已存在 → 完全替换整个文件夹及其所有内容
# - 警告：目标工作区原有的 xx文件夹 内所有文件都会丢失

# 示例3：同步嵌套路径
/links .claude/configs/linked-workspace.yaml
# 行为：
# - 目标：其他工作区的 .claude/configs/linked-workspace.yaml
# - 不存在 → 递归创建目录并新增文件
# - 已存在 → 仅替换该yaml文件
# - 注意：.claude/configs/ 下的其他文件不受影响
```

## ⚠️ 重要特性说明

### 新增或覆盖 vs 合并式
**本命令采用新增或覆盖（Create or Overwrite）同步策略**：

```yaml
新增或覆盖同步（Create or Overwrite Mode - 本命令使用）:
  行为:
    - 目标路径不存在 → 新增（创建文件/文件夹）
    - 目标路径已存在 → 完全替换
  结果: 目标路径内容 = 源路径内容（100%一致）
  风险: 已存在的目标内容会丢失
  适用场景:
    ✅ 配置文件标准化
    ✅ 版本一致性要求
    ✅ 模板文件分发
    ✅ 新项目结构应用

  示例:
    源: config.yaml (version: 2.0, new_field: value)
    目标不存在: → 新增 config.yaml
    目标已存在: config.yaml (version: 1.0, old_field: legacy)
                → 完全替换为 (version: 2.0, new_field: value)

合并式同步（Merge Mode - 本命令不支持）:
  行为: 尝试合并源文件和目标文件的内容
  结果: 目标文件保留原有内容 + 新增源文件内容
  风险: 可能产生冲突需要手动解决
  适用场景:
    - Git合并操作
    - 配置文件增量更新
    - 保留本地修改
```

## 关键特性

- ⚠️ **基于相对路径的精确同步** - 只影响指定的相对路径，不影响其他文件
- ⚠️ **新增或覆盖** - 目标路径不存在则新增，已存在则完全替换（非合并式）
- ✅ **多工作区管理** - 基于`.claude/configs/linked-workspace.yaml`自动识别所有关联工作区
- ✅ **智能同步机制** - 支持文件、文件夹、通配符、多路径等多种同步模式
- ✅ **安全操作保障** - 提供三阶段确认机制、关键文件保护和回滚建议
- ✅ **批量处理能力** - 支持多路径同时同步和通配符模式批量操作
- ✅ **完整日志系统** - 记录所有同步操作，支持问题追踪和审计

## 使用场景

1. **跨项目配置标准化** - 将`.claude/configs/`配置同步到其他项目（不存在则新增，存在则覆盖）
2. **文档版本统一** - 将README.md等文档同步到所有关联项目
3. **模板文件分发** - 同步脚本、模板等通用开发资源
4. **项目结构应用** - 将新的文件/文件夹结构应用到现有项目

---

**注意**: 由于文件过长，完整的命令文档已移至项目根目录。本文件仅包含核心说明和覆盖式操作警告。

完整文档请参阅:
- 功能详解和使用方法
- 安全检查与错误处理
- 性能优化策略
- 最佳实践和使用示例

# 🔧 使用方法

## 基本用法

### ⚠️ 新增或覆盖同步说明

**重要**: 以下所有操作基于相对路径进行新增或覆盖！

```bash
# 同步单个文件
/links README.md
# 行为:
# - 目标工作区的 README.md 不存在 → 新增该文件
# - 目标工作区的 README.md 已存在 → 完全替换内容

# 同步单个文件夹
/links .claude/commands/
# 行为:
# - 目标工作区的 .claude/commands/ 不存在 → 新增该文件夹及所有内容
# - 目标工作区的 .claude/commands/ 已存在 → 完全替换该文件夹及所有内容
# - 警告: 目标工作区原有的 .claude/commands/ 内所有文件都会丢失

# 同步多个路径（批量操作）
/links README.md src/ docs/ package.json
# 行为: 对每个路径分别执行新增或覆盖操作
# - README.md: 不存在则新增，存在则覆盖
# - src/: 不存在则新增整个文件夹，存在则完全替换
# - docs/: 不存在则新增整个文件夹，存在则完全替换
# - package.json: 不存在则新增，存在则覆盖
```

## 通配符模式

```bash
# 同步所有Markdown文件
/links *.md
# 行为: 对每个匹配的.md文件，不存在则新增，存在则覆盖

# 同步src目录下所有内容
/links src/*
# 行为: 对src/下的每个文件/文件夹，不存在则新增，存在则覆盖

# 同步.claude目录下所有Markdown文件（递归）
/links .claude/**/*.md
# 行为: 递归查找所有.md文件，对每个文件执行新增或覆盖

# 组合使用（批量操作）
/links *.md src/*.py docs/**/*.md
# 行为: 对所有匹配的路径，分别执行新增或覆盖
```

## 高级参数

```bash
# 预览模式（查看将被新增或覆盖的文件，不执行实际操作）
/links --preview README.md
# 推荐: 在实际操作前先预览影响范围

# 强制模式（跳过确认，直接执行新增或覆盖）
/links --force .claude/configs/
# 警告: 使用此参数将不会有任何确认提示

# 指定目标工作区（仅同步到指定工作区）
/links --target=workspace-1 README.md

# 详细输出模式（显示详细的同步过程）
/links --verbose src/
```

## 配置文件同步

```bash
# 同步Claude配置
/links .claude/configs/
# 行为:
# - 目标工作区没有.claude/configs/ → 新增整个目录
# - 目标工作区已有.claude/configs/ → 完全替换该目录

# 同步版本控制配置
/links .gitignore .editorconfig
# 行为: 对每个文件，不存在则新增，存在则覆盖

# 同步开发环境配置
/links .vscode/ .prettier* .eslint*
# 行为: 对每个路径/模式，执行新增或覆盖
```

# ⚠️ 注意事项

## ⚠️ 安全警告

### ⚠️ 新增或覆盖操作特别警告

**本命令使用新增或覆盖同步，非合并式！**

1. **操作不可逆且基于相对路径**
   - ⚠️ **目标路径不存在 → 新增文件/文件夹**
   - ⚠️ **目标路径已存在 → 完全替换内容（已存在内容会丢失）**
   - ⚠️ **没有合并机制，只有新增或完全替换**
   - ⚠️ **只影响指定的相对路径，不影响其他文件**
   - 操作前会提示确认（除非使用--force参数）
   - **强烈建议**使用`--preview`模式预览影响范围
   - **重要文件必须手动备份**（建议使用Git版本控制）

2. **受保护文件自动跳过**（即使指定也不会同步）
   - `.git/` 版本控制目录
   - `node_modules/` 依赖目录
   - `.env` 环境变量文件
   - `*.key` 密钥文件

3. **典型操作场景**
   ```yaml
   适合新增或覆盖:
     ✅ 配置文件标准化（强制版本一致）
     ✅ 模板文件分发（新项目新增，旧项目替换）
     ✅ 文档版本统一（覆盖旧版本）
     ✅ 新文件/文件夹结构应用

   不适合新增或覆盖:
     ❌ 需要保留本地修改的文件
     ❌ 需要合并内容的配置文件
     ❌ 包含个性化设置的文件

   推荐做法:
     1. 使用 --preview 预览将被新增或覆盖的路径
     2. 对重要文件提前备份或使用Git
     3. 确认无本地修改需要保留后再执行
   ```

4. **磁盘空间检查**
   - 需要1.5倍文件大小的空间
   - 空间不足会提前警告
   - 建议定期清理临时文件

## ⚠️ 最佳实践

### 1. 同步前准备（必做）

- ✅ **确认工作区配置正确**
- ✅ **必须使用`--preview`模式预览影响范围**
- ✅ **重要文件必须先备份**（建议使用Git版本控制）
- ✅ **确认目标工作区没有需要保留的本地修改**
- ✅ **理解机制：相对路径 + 新增或覆盖，非合并**

### 2. 同步策略

```yaml
推荐同步的文件类型:
  ✅ 配置模板文件（.claude/configs/linked-workspace.yaml）
  ✅ 共享的标准化配置（.prettierrc, .eslintrc）
  ✅ 文档模板（README.md模板）
  ✅ 共享脚本（无个性化内容）

避免同步的文件类型:
  ❌ 包含项目特定配置的文件
  ❌ 包含个人设置的文件
  ❌ 有本地修改需要保留的文件
  ❌ 需要合并而非替换的文件
```

- 配置文件优先同步（确保一致性）
- 避免同步大文件（性能考虑）
- 定期清理缓存

### 3. 错误处理与恢复

- 检查日志文件了解同步详情
- 记录失败操作
- 及时修复问题
- **如有误操作，使用Git恢复或从备份恢复**

---

**指令版本**: v4.1.0
**最后更新**: 2025-01-27
**维护原则**: 基于相对路径的新增或覆盖、安全第一、用户友好、明确警告
