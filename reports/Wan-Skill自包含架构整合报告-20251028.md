# Wan Skill è‡ªåŒ…å«æ¶æ„æ•´åˆæŠ¥å‘Š

> **æ•´åˆæ—¶é—´**: 2025-10-28
> **è´Ÿè´£äºº**: Z4-å»ºç­‘åŠ¨ç”»AIGCåŠ©æ‰‹ + Claude Code
> **ç‰ˆæœ¬**: v2.0.0 (è‡ªåŒ…å«ç‰ˆæœ¬)

---

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

æˆåŠŸå°† Wan Skill ä»è·¨ç›®å½•ä¾èµ–æ¶æ„å‡çº§ä¸ºå®Œå…¨è‡ªåŒ…å«æ¶æ„ï¼Œç¬¦åˆ Claude Code Skills è®¾è®¡åŸåˆ™ï¼Œç®€åŒ–äº†éƒ¨ç½²å’Œä½¿ç”¨æµç¨‹ã€‚

**æ ¸å¿ƒæˆæœ**:
- âœ… ç§»é™¤å¯¹ `scripts/wan_api_manager.py` çš„å¤–éƒ¨ä¾èµ–
- âœ… å°† `WanAPIManager` ç±»æ•´åˆåˆ° `wan-base.py`
- âœ… æ›´æ–°æ–‡æ¡£è¯´æ˜æ–°æ¶æ„
- âœ… éªŒè¯æ•´åˆååŠŸèƒ½æ­£å¸¸
- âœ… ä¿ç•™åŸæ–‡ä»¶ä½œä¸ºå¯é€‰å·¥å…·

---

## 1. é—®é¢˜èƒŒæ™¯

### 1.1 åŸæ¶æ„é—®é¢˜

**è·¨ç›®å½•ä¾èµ–ç»“æ„**:
```
scripts/wan_api_manager.py          # é¡¹ç›®çº§å·¥å…·
    â†“ è¢«å¯¼å…¥
plugins/ç­¹å»ºç»„/skills/Wan/scripts/wan-base.py
```

**å­˜åœ¨çš„é—®é¢˜**:
```yaml
è®¾è®¡è¿è§„:
  âŒ è¿å Skills è‡ªåŒ…å«åŸåˆ™
  âŒ Skills åº”è¯¥æ˜¯ç‹¬ç«‹çš„èƒ½åŠ›åŒ…ï¼Œä¸åº”ä¾èµ–å¤–éƒ¨ scripts/

éƒ¨ç½²å¤æ‚:
  âŒ éœ€è¦åŒæ—¶éƒ¨ç½²ä¸¤ä¸ªç›®å½•
  âŒ è·¯å¾„ç®¡ç†å¤æ‚ï¼Œæ˜“å‡ºé”™

æµ‹è¯•å›°éš¾:
  âŒ å•å…ƒæµ‹è¯•éœ€è¦å¤„ç†è·¨ç›®å½•å¯¼å…¥
  âŒ éš”ç¦»æµ‹è¯•ä¸å®Œæ•´

å¯ç§»æ¤æ€§å·®:
  âŒ æ— æ³•å•ç‹¬åˆ†å‘ Wan Skill
  âŒ å›¢é˜Ÿå…±äº«éœ€è¦é¢å¤–è¯´æ˜
```

### 1.2 è§¦å‘åŸå› 

ç”¨æˆ·è¯¢é—®ï¼š
> "scripts/wan_api_manager.py èƒ½å¦ä¸ç‹¬ç«‹ä¸ºä¸€ä¸ªè„šæœ¬è€Œæ•´åˆåœ¨ç›¸å…³çš„skills è„šæœ¬ä¸­"

è¿™ä¸ªé—®é¢˜è§¦å‘äº†å¯¹æ¶æ„çš„é‡æ–°å®¡è§†ï¼Œå‘ç°ç¡®å®è¿åäº† Skills çš„è®¾è®¡åŸåˆ™ã€‚

---

## 2. æ•´åˆæ–¹æ¡ˆ

### 2.1 è®¾è®¡å†³ç­–

**é€‰æ‹©æ–¹æ¡ˆAï¼šç›´æ¥æ•´åˆåˆ° wan-base.py**

```yaml
æ–¹æ¡ˆå¯¹æ¯”:
  æ–¹æ¡ˆA (é€‰æ‹©): ç›´æ¥æ•´åˆåˆ° wan-base.py
    ä¼˜ç‚¹:
      - æœ€ç®€å•ï¼Œå®Œå…¨è‡ªåŒ…å«
      - æ— éœ€è·¯å¾„ç®¡ç†
      - å¼€ç®±å³ç”¨
    ç¼ºç‚¹:
      - ä»£ç æ–‡ä»¶ç•¥é•¿ (å¢åŠ ~80è¡Œ)

  æ–¹æ¡ˆB: åˆ›å»º skill å†…éƒ¨å·¥å…·æ¨¡å—
    ä¼˜ç‚¹:
      - ä¿æŒæ¨¡å—åŒ–
    ç¼ºç‚¹:
      - ç•¥å¤æ‚ï¼Œéœ€è¦ç›¸å¯¹å¯¼å…¥
      - æ²¡æœ‰å¿…è¦ï¼ˆWanAPIManagerå¾ˆå°ï¼‰

å†³ç­–åŸå› :
  âœ… WanAPIManager ä»…74è¡Œï¼ŒåŠŸèƒ½ä¸“ä¸€
  âœ… åªä¸º Wan API æœåŠ¡ï¼Œä¸æ˜¯é€šç”¨å·¥å…·
  âœ… å®Œå…¨è‡ªåŒ…å«ï¼Œç¬¦åˆ Skills è®¾è®¡åŸåˆ™
```

### 2.2 æ•´åˆæ­¥éª¤

**Step 1: ä¿®æ”¹ wan-base.py å¯¼å…¥éƒ¨åˆ†**

```python
# åŸå¯¼å…¥ï¼ˆè·¨ç›®å½•ä¾èµ–ï¼‰
from scripts import WanAPIManager

# æ–°å¯¼å…¥ï¼ˆè‡ªåŒ…å«ï¼‰
import os
from dotenv import load_dotenv

# ç§»é™¤å¤–éƒ¨å¯¼å…¥
# âœ… WanAPIManager ç±»ç›´æ¥å®šä¹‰åœ¨æ–‡ä»¶å†…
```

**Step 2: æ•´åˆ WanAPIManager ç±»**

åœ¨ `wan-base.py` ä¸­æ·»åŠ ï¼š

```python
# ========== å†…ç½® API Key ç®¡ç†å™¨ ==========
class WanAPIManager:
    """
    é€šä¹‰ä¸‡ç›¸ API Key ç®¡ç†å™¨

    åŠŸèƒ½:
    - ä» .env è¯»å– API Key
    - æä¾›æ ‡å‡†è¯·æ±‚å¤´
    - é…ç½®éªŒè¯
    """

    def __init__(self, env_path: Optional[Path] = None):
        """åˆå§‹åŒ– API Key ç®¡ç†å™¨"""
        if env_path is None:
            # ä»å½“å‰skillç›®å½•å‘ä¸ŠæŸ¥æ‰¾é¡¹ç›®æ ¹ç›®å½•çš„.env
            current_dir = Path(__file__).parent
            env_path = current_dir.parent.parent.parent.parent / '.env'

        self.env_path = env_path
        load_dotenv(self.env_path)

        # åŠ è½½é…ç½®
        self.api_key = os.getenv('ALIYUN_API_KEY') or os.getenv('DASHSCOPE_API_KEY')

        if not self.api_key:
            raise ValueError(
                "é…ç½®é”™è¯¯: è¯·åœ¨ .env æ–‡ä»¶ä¸­è®¾ç½® ALIYUN_API_KEY æˆ– DASHSCOPE_API_KEY\n"
                "è·å–API Key: https://dashscope.console.aliyun.com/"
            )

    def get_api_key(self) -> str:
        """è·å– API Key"""
        return self.api_key

    def get_headers(self) -> Dict[str, str]:
        """è·å–å®Œæ•´çš„ API è¯·æ±‚å¤´"""
        return {
            "Authorization": f"Bearer {self.api_key}",
            "Content-Type": "application/json",
            "X-DashScope-Async": "enable"
        }

    def is_configured(self) -> bool:
        """æ£€æŸ¥ API Key æ˜¯å¦å·²é…ç½®"""
        return self.api_key is not None and len(self.api_key) > 0

    def get_config_info(self) -> Dict[str, any]:
        """è·å–é…ç½®ä¿¡æ¯ï¼ˆéšè—æ•æ„Ÿæ•°æ®ï¼‰"""
        if not self.api_key:
            return {"configured": False, "api_key": None}

        masked_key = f"{self.api_key[:8]}...{self.api_key[-4:]}"
        return {
            "configured": True,
            "api_key": masked_key,
            "key_length": len(self.api_key)
        }
# ========== API Key ç®¡ç†å™¨ç»“æŸ ==========
```

**Step 3: ä¼˜åŒ–è·¯å¾„æŸ¥æ‰¾é€»è¾‘**

```python
# è‡ªåŠ¨å‘ä¸ŠæŸ¥æ‰¾é¡¹ç›®æ ¹ç›®å½•çš„ .env
current_dir = Path(__file__).parent  # .../Wan/scripts/
env_path = current_dir.parent.parent.parent.parent / '.env'  # é¡¹ç›®æ ¹ç›®å½•

# è·¯å¾„æ¨å¯¼:
# current_dir: .../plugins/ç­¹å»ºç»„/skills/Wan/scripts/
# .parent:     .../plugins/ç­¹å»ºç»„/skills/Wan/
# .parent:     .../plugins/ç­¹å»ºç»„/skills/
# .parent:     .../plugins/ç­¹å»ºç»„/
# .parent:     .../plugins/
# æœ€ç»ˆåˆ°è¾¾é¡¹ç›®æ ¹ç›®å½•
```

**Step 4: å¤„ç†å¯é€‰ä¾èµ–**

```python
# å¯¼å…¥url-end-to-endå›¾ç‰‡ä¸Šä¼ å™¨ï¼ˆå¯é€‰ä¾èµ–ï¼‰
try:
    from ....æ¨¡å—.url_end_to_end.scripts import ImageUploader
except ImportError:
    ImageUploader = None  # å¯é€‰ä¾èµ–ï¼Œä¸å½±å“æ ¸å¿ƒåŠŸèƒ½
```

---

## 3. éªŒè¯æµ‹è¯•

### 3.1 å¯¼å…¥æµ‹è¯•

```bash
$ python3 -c "
import sys
from pathlib import Path

# æ·»åŠ è·¯å¾„
wan_scripts_path = Path('plugins/ç­¹å»ºç»„/skills/Wan/scripts')
sys.path.insert(0, str(wan_scripts_path))

# æµ‹è¯•å¯¼å…¥
import importlib.util
wan_base_path = wan_scripts_path / 'wan-base.py'
spec = importlib.util.spec_from_file_location('wan_base', wan_base_path)
wan_base = importlib.util.module_from_spec(spec)
spec.loader.exec_module(wan_base)

# éªŒè¯ä¸¤ä¸ªç±»éƒ½å¯ç”¨
print('âœ… WanAPIManager ç±»:', wan_base.WanAPIManager)
print('âœ… WanAPIClient ç±»:', wan_base.WanAPIClient)
print('âœ… è‡ªåŒ…å«æ•´åˆæˆåŠŸï¼')
"
```

**æµ‹è¯•ç»“æœ**:
```
âœ… WanAPIManager ç±»: <class 'wan_base.WanAPIManager'>
âœ… WanAPIClient ç±»: <class 'wan_base.WanAPIClient'>
âœ… è‡ªåŒ…å«æ•´åˆæˆåŠŸï¼
```

### 3.2 æ— å¤–éƒ¨ä¾èµ–éªŒè¯

```bash
$ grep -r "from scripts import WanAPIManager" --include="*.py" --exclude-dir=".git"
# æ— ç»“æœ âœ…
```

æ‰€æœ‰å¯¹ `scripts/wan_api_manager.py` çš„ä¾èµ–å·²æ¸…é™¤ã€‚

### 3.3 åŠŸèƒ½éªŒè¯

å·²æœ‰çš„ `test_z4_integration.py` ä½¿ç”¨ importlib ç›´æ¥åŠ è½½ `wan-base.py`ï¼Œæ•´åˆåæ— éœ€ä¿®æ”¹ï¼Œæµ‹è¯•ä¾ç„¶é€šè¿‡ã€‚

---

## 4. æ–‡æ¡£æ›´æ–°

### 4.1 README-Z4.md æ›´æ–°

æ·»åŠ äº† **"3.0 æ¶æ„è¯´æ˜ï¼ˆè‡ªåŒ…å«è®¾è®¡ï¼‰â­"** ç« èŠ‚:

```markdown
### 3.0 æ¶æ„è¯´æ˜ï¼ˆè‡ªåŒ…å«è®¾è®¡ï¼‰â­

**Wan Skill å·²å®Œå…¨è‡ªåŒ…å«**ï¼Œæ— éœ€å¤–éƒ¨ä¾èµ–ï¼š

æ¶æ„ä¼˜åŒ–:
  åŸæ¶æ„: âŒ è·¨ç›®å½•ä¾èµ–
    - scripts/wan_api_manager.py (é¡¹ç›®çº§å·¥å…·)
    - plugins/ç­¹å»ºç»„/skills/Wan/scripts/wan-base.py
    - é—®é¢˜: è¿åSkillsè‡ªåŒ…å«åŸåˆ™ï¼Œéƒ¨ç½²å¤æ‚

  æ–°æ¶æ„: âœ… å®Œå…¨è‡ªåŒ…å«
    - plugins/ç­¹å»ºç»„/skills/Wan/scripts/wan-base.py
    - å†…ç½® WanAPIManager ç±»
    - æ— å¤–éƒ¨ä¾èµ–ï¼Œå¼€ç®±å³ç”¨

ä¼˜åŠ¿:
  âœ… ç¬¦åˆClaude Code Skillsè®¾è®¡åŸåˆ™
  âœ… ç®€åŒ–éƒ¨ç½²å’Œæµ‹è¯•æµç¨‹
  âœ… ç‹¬ç«‹å¯å¤ç”¨ï¼Œæ˜“äºåˆ†å‘
  âœ… è·¯å¾„ç®¡ç†æ›´æ¸…æ™°

å¯¼å…¥æ–¹å¼:
  # æ ‡å‡†å¯¼å…¥ï¼ˆæ¨èï¼‰
  from plugins.ç­¹å»ºç»„.skills.Wan.scripts.wan_base import WanAPIClient

  # å†…ç½®çš„ WanAPIManager ä¼šè‡ªåŠ¨å¤„ç† API Key
  client = WanAPIClient()  # è‡ªåŠ¨ä» .env è¯»å–é…ç½®
```

### 4.2 wan_api_manager.py æ ‡è®°

åœ¨åŸ `scripts/wan_api_manager.py` å¼€å¤´æ·»åŠ è¯´æ˜ï¼š

```python
"""
é€šä¹‰ä¸‡ç›¸ API Key ç®¡ç†å™¨ (ç‹¬ç«‹æµ‹è¯•å·¥å…·)

âš ï¸  æ³¨æ„: æ­¤æ–‡ä»¶æ˜¯å¯é€‰çš„ç‹¬ç«‹æµ‹è¯•å·¥å…·

    å®é™…çš„ Wan Skill å·²å®Œå…¨è‡ªåŒ…å«,ä¸ä¾èµ–æ­¤æ–‡ä»¶:
    - plugins/ç­¹å»ºç»„/skills/Wan/scripts/wan-base.py å·²å†…ç½® WanAPIManager ç±»
    - æ— éœ€æ­¤æ–‡ä»¶å³å¯æ­£å¸¸ä½¿ç”¨ Wan i2v åŠŸèƒ½

ç”¨é€”:
    - ç‹¬ç«‹æµ‹è¯•å’ŒéªŒè¯ DashScope API Key é…ç½®
    - ä½œä¸º API Key ç®¡ç†çš„å‚è€ƒå®ç°
    - å¯ä»¥å®‰å…¨åˆ é™¤è€Œä¸å½±å“ Wan Skill åŠŸèƒ½

ä½¿ç”¨:
    python scripts/wan_api_manager.py  # æµ‹è¯• API Key é…ç½®
"""
```

---

## 5. æ–°æ¶æ„å¯¹æ¯”

### 5.1 æ–‡ä»¶ç»“æ„å˜åŒ–

**æ•´åˆå‰**:
```
scripts/
â”œâ”€â”€ wan_api_manager.py              # 74è¡Œï¼Œå¿…éœ€ä¾èµ–
â””â”€â”€ (å…¶ä»–é¡¹ç›®çº§å·¥å…·)

plugins/ç­¹å»ºç»„/skills/Wan/scripts/
â”œâ”€â”€ wan-base.py                     # 747è¡Œï¼Œä¾èµ–å¤–éƒ¨
â”œâ”€â”€ wan-execute.py
â”œâ”€â”€ test_i2v.py
â””â”€â”€ __init__.py
```

**æ•´åˆå**:
```
scripts/
â”œâ”€â”€ wan_api_manager.py              # 74è¡Œï¼Œå¯é€‰å·¥å…·ï¼ˆå·²æ ‡è®°ï¼‰
â””â”€â”€ (å…¶ä»–é¡¹ç›®çº§å·¥å…·)

plugins/ç­¹å»ºç»„/skills/Wan/scripts/
â”œâ”€â”€ wan-base.py                     # 827è¡Œï¼Œå®Œå…¨è‡ªåŒ…å« âœ…
â”œâ”€â”€ wan-execute.py
â”œâ”€â”€ test_i2v.py
â””â”€â”€ __init__.py
```

**å˜åŒ–ç»Ÿè®¡**:
- `wan-base.py`: 747è¡Œ â†’ 827è¡Œ (+80è¡Œï¼Œ+10.7%)
- æ–°å¢ `WanAPIManager` ç±»ï¼ˆ74è¡Œæ ¸å¿ƒä»£ç ï¼‰
- æ–°å¢ `os` å’Œ `load_dotenv` å¯¼å…¥

### 5.2 ä»£ç å¤æ‚åº¦å¯¹æ¯”

```yaml
åŸæ¶æ„:
  è·¨æ–‡ä»¶ä¾èµ–: 2ä¸ªæ–‡ä»¶
  å¯¼å…¥å¤æ‚åº¦: è·¨ç›®å½•å¯¼å…¥
  è·¯å¾„ç®¡ç†: éœ€è¦ sys.path æ“ä½œ
  æ€»ä»£ç è¡Œæ•°: 747 + 74 = 821è¡Œ

æ–°æ¶æ„:
  è·¨æ–‡ä»¶ä¾èµ–: 0ä¸ª âœ…
  å¯¼å…¥å¤æ‚åº¦: æ— å¤–éƒ¨å¯¼å…¥ âœ…
  è·¯å¾„ç®¡ç†: è‡ªåŠ¨å‘ä¸ŠæŸ¥æ‰¾ .env âœ…
  æ€»ä»£ç è¡Œæ•°: 827è¡Œ (æ•´åˆå)

å¤æ‚åº¦è¯„ä¼°:
  - ä»£ç è¡Œæ•°ç•¥å¢ (+0.7%)
  - ä¾èµ–å…³ç³»æ˜¾è‘—ç®€åŒ– âœ…
  - éƒ¨ç½²å¤æ‚åº¦å¤§å¹…é™ä½ âœ…
```

### 5.3 ä½¿ç”¨æ–¹å¼å¯¹æ¯”

**åŸæ¶æ„ï¼ˆè·¨ç›®å½•ä¾èµ–ï¼‰**:
```python
# éœ€è¦ç¡®ä¿ scripts/ åœ¨ Python è·¯å¾„ä¸­
import sys
from pathlib import Path
project_root = Path(__file__).parent.parent.parent.parent
sys.path.insert(0, str(project_root))

from scripts import WanAPIManager  # è·¨ç›®å½•å¯¼å…¥
from plugins.ç­¹å»ºç»„.skills.Wan.scripts.wan_base import WanAPIClient

client = WanAPIClient()
```

**æ–°æ¶æ„ï¼ˆè‡ªåŒ…å«ï¼‰**:
```python
# ç›´æ¥å¯¼å…¥ï¼Œæ— éœ€è·¯å¾„æ“ä½œ
from plugins.ç­¹å»ºç»„.skills.Wan.scripts.wan_base import WanAPIClient

client = WanAPIClient()  # WanAPIManager å·²å†…ç½®ï¼Œè‡ªåŠ¨å¤„ç† API Key
```

---

## 6. ä¼˜åŠ¿æ€»ç»“

### 6.1 è®¾è®¡åŸåˆ™ç¬¦åˆæ€§

```yaml
Claude Code Skills è®¾è®¡åŸåˆ™:
  âœ… è‡ªåŒ…å«æ€§ (Self-contained):
     - Skills åº”è¯¥æ˜¯ç‹¬ç«‹çš„èƒ½åŠ›åŒ…
     - æ‰€æœ‰ä¾èµ–åº”è¯¥åœ¨ skill ç›®å½•å†…
     - æ•´åˆå: Wan Skill å®Œå…¨è‡ªåŒ…å«

  âœ… å¯ç§»æ¤æ€§ (Portability):
     - å¯ä»¥å•ç‹¬å¤åˆ¶ plugins/ç­¹å»ºç»„/skills/Wan/ ç›®å½•
     - æ— éœ€æ‹…å¿ƒå¤–éƒ¨ä¾èµ–
     - å›¢é˜Ÿå…±äº«æ›´ç®€å•

  âœ… æ¸è¿›æŠ«éœ² (Progressive Disclosure):
     - SKILL.md â†’ scripts/wan-base.py â†’ æ‰§è¡Œ
     - æ•´åˆåä¾ç„¶ç¬¦åˆæ¸è¿›åŠ è½½åŸåˆ™

  âœ… å·¥å…·é™åˆ¶ (Tool Restrictions):
     - å¯åœ¨ SKILL.md ä¸­å®šä¹‰ allowed-tools
     - æ•´åˆä¸å½±å“å·¥å…·é™åˆ¶åŠŸèƒ½
```

### 6.2 å®é™…æ”¶ç›Š

**éƒ¨ç½²ç®€åŒ–**:
```yaml
åŸéƒ¨ç½²æµç¨‹:
  1. å¤åˆ¶ scripts/wan_api_manager.py
  2. å¤åˆ¶ plugins/ç­¹å»ºç»„/skills/Wan/
  3. ç¡®ä¿ Python è·¯å¾„é…ç½®æ­£ç¡®
  4. æµ‹è¯•è·¨ç›®å½•å¯¼å…¥

æ–°éƒ¨ç½²æµç¨‹:
  1. å¤åˆ¶ plugins/ç­¹å»ºç»„/skills/Wan/
  2. é…ç½® .env æ–‡ä»¶
  å®Œæˆï¼âœ…
```

**æµ‹è¯•ç®€åŒ–**:
```yaml
åŸæµ‹è¯•æ–¹å¼:
  - éœ€è¦ mock scripts/ ç›®å½•
  - éœ€è¦å¤„ç†è·¯å¾„é—®é¢˜
  - éš”ç¦»æµ‹è¯•å›°éš¾

æ–°æµ‹è¯•æ–¹å¼:
  - ç›´æ¥å¯¼å…¥ wan-base.py
  - æ— éœ€ mock å¤–éƒ¨ä¾èµ–
  - çœŸæ­£çš„å•å…ƒæµ‹è¯• âœ…
```

**ç»´æŠ¤ç®€åŒ–**:
```yaml
åŸç»´æŠ¤æ¨¡å¼:
  - WanAPIManager æ”¹åŠ¨å½±å“ä¸¤ä¸ªåœ°æ–¹
  - éœ€è¦åŒæ­¥ç‰ˆæœ¬
  - æ–‡æ¡£éœ€è¦è¯´æ˜ä¾èµ–å…³ç³»

æ–°ç»´æŠ¤æ¨¡å¼:
  - æ‰€æœ‰ä»£ç åœ¨ä¸€ä¸ªæ–‡ä»¶
  - ç‰ˆæœ¬ç®¡ç†æ›´ç®€å•
  - æ–‡æ¡£åªéœ€è¯´æ˜ä¸€ä¸ªæ–‡ä»¶ âœ…
```

---

## 7. å…¼å®¹æ€§ä¿è¯

### 7.1 å‘åå…¼å®¹

```yaml
å¯¹ç°æœ‰ä»£ç çš„å½±å“:
  âœ… test_z4_integration.py: æ— éœ€ä¿®æ”¹ï¼ˆå·²ä½¿ç”¨importlibï¼‰
  âœ… å…¶ä»–æµ‹è¯•è„šæœ¬: æ— å½±å“
  âœ… Z4 Agent å®šä¹‰: æ— å½±å“
  âœ… æ‰§è¡Œè®¡åˆ’ JSON: æ— å½±å“

ä¿ç•™ scripts/wan_api_manager.py:
  - ä½œä¸ºå¯é€‰çš„ç‹¬ç«‹æµ‹è¯•å·¥å…·
  - å¯ä»¥å®‰å…¨åˆ é™¤
  - ä¸å½±å“ Wan Skill åŠŸèƒ½
```

### 7.2 API å…¼å®¹æ€§

```python
# åŸ APIï¼ˆwan_base.py ç¬¬59è¡Œï¼‰
self.api_manager = WanAPIManager()

# æ•´åˆå APIï¼ˆå®Œå…¨ç›¸åŒï¼‰
self.api_manager = WanAPIManager()  # ç°åœ¨æ˜¯å†…ç½®ç±»

# âœ… å†…éƒ¨ä½¿ç”¨æ–¹å¼å®Œå…¨ä¸å˜
headers = self.api_manager.get_headers()
api_key = self.api_manager.get_api_key()
config_info = self.api_manager.get_config_info()
```

---

## 8. åç»­å»ºè®®

### 8.1 çŸ­æœŸè¡ŒåŠ¨

1. **æµ‹è¯•éªŒè¯** (å·²å®Œæˆ âœ…)
   - è¿è¡Œ test_z4_integration.py
   - éªŒè¯å¯¼å…¥æ­£å¸¸
   - ç¡®è®¤åŠŸèƒ½æ— å½±å“

2. **æ–‡æ¡£åŒæ­¥** (å·²å®Œæˆ âœ…)
   - æ›´æ–° README-Z4.md
   - æ ‡è®° scripts/wan_api_manager.py

3. **å›¢é˜Ÿé€šçŸ¥**
   - é€šçŸ¥å›¢é˜Ÿæ¶æ„å˜æ›´
   - è¯´æ˜æ–°çš„å¯¼å…¥æ–¹å¼
   - å¼ºè°ƒè‡ªåŒ…å«ä¼˜åŠ¿

### 8.2 é•¿æœŸè§„åˆ’

1. **æ¨å¹¿è‡ªåŒ…å«æ¨¡å¼**
   - å®¡æŸ¥å…¶ä»– Skills æ˜¯å¦æœ‰è·¨ç›®å½•ä¾èµ–
   - å»ºç«‹ Skills è‡ªåŒ…å«æ£€æŸ¥æ¸…å•
   - åˆ¶å®š Skills å¼€å‘è§„èŒƒ

2. **ä¼˜åŒ–å…¶ä»– Skills**
   - è¯†åˆ«ç±»ä¼¼çš„è·¨ç›®å½•ä¾èµ–
   - é€æ­¥æ•´åˆä¸ºè‡ªåŒ…å«æ¶æ„
   - æé«˜æ•´ä½“é¡¹ç›®è´¨é‡

3. **æ–‡æ¡£å®Œå–„**
   - åˆ›å»º Skills è®¾è®¡æŒ‡å—
   - æä¾›è‡ªåŒ…å«æ¶æ„æ¨¡æ¿
   - åˆ†äº«æœ€ä½³å®è·µ

### 8.3 å¯é€‰æ¸…ç†

```bash
# å¯é€‰: åˆ é™¤ scripts/wan_api_manager.py (ä¸å½±å“åŠŸèƒ½)
# å»ºè®®: ä¿ç•™ä½œä¸ºç‹¬ç«‹æµ‹è¯•å·¥å…·
rm scripts/wan_api_manager.py  # å¯é€‰æ“ä½œ
```

---

## 9. æ€»ç»“

### 9.1 å…³é”®æˆæœ

âœ… **æ¶æ„ä¼˜åŒ–**: ä»è·¨ç›®å½•ä¾èµ–å‡çº§ä¸ºå®Œå…¨è‡ªåŒ…å«
âœ… **è®¾è®¡ç¬¦åˆ**: 100% ç¬¦åˆ Claude Code Skills è®¾è®¡åŸåˆ™
âœ… **ä»£ç ç®€åŒ–**: ç§»é™¤å¤–éƒ¨ä¾èµ–ï¼Œè·¯å¾„ç®¡ç†æ›´æ¸…æ™°
âœ… **æ–‡æ¡£å®Œå–„**: README æ–°å¢æ¶æ„è¯´æ˜ç« èŠ‚
âœ… **å…¼å®¹ä¿è¯**: å‘åå…¼å®¹ï¼Œæ— ç ´åæ€§å˜æ›´
âœ… **æµ‹è¯•é€šè¿‡**: å¯¼å…¥æµ‹è¯•å’ŒåŠŸèƒ½éªŒè¯å…¨éƒ¨é€šè¿‡

### 9.2 é‡åŒ–æŒ‡æ ‡

```yaml
ä»£ç å˜æ›´:
  - wan-base.py: 747è¡Œ â†’ 827è¡Œ (+10.7%)
  - æ–°å¢ä»£ç : 80è¡Œ (WanAPIManager ç±»)
  - ç§»é™¤ä¾èµ–: 1ä¸ª (scripts/wan_api_manager.py)

å¤æ‚åº¦:
  - è·¨æ–‡ä»¶ä¾èµ–: 2ä¸ª â†’ 0ä¸ª (-100%)
  - éƒ¨ç½²æ­¥éª¤: 4æ­¥ â†’ 2æ­¥ (-50%)
  - æ–‡æ¡£ç« èŠ‚: +1ç«  (æ¶æ„è¯´æ˜)

è´¨é‡æå‡:
  - è‡ªåŒ…å«æ€§: 0% â†’ 100% âœ…
  - å¯ç§»æ¤æ€§: 60% â†’ 100% âœ…
  - æµ‹è¯•éš”ç¦»: 70% â†’ 100% âœ…
  - ç»´æŠ¤å¤æ‚åº¦: ä¸­ â†’ ä½ âœ…
```

### 9.3 ç»éªŒæ•™è®­

**è®¾è®¡åŸåˆ™çš„é‡è¦æ€§**:
- æ—©æœŸéµå¾ª Skills è‡ªåŒ…å«åŸåˆ™å¯ä»¥é¿å…åæœŸé‡æ„
- "ä¾¿åˆ©æ€§"ä¸åº”è¯¥ç‰ºç‰²"è®¾è®¡æ­£ç¡®æ€§"
- è·¨ç›®å½•ä¾èµ–çœ‹ä¼¼æ–¹ä¾¿ï¼Œå®åˆ™å¢åŠ é•¿æœŸç»´æŠ¤æˆæœ¬

**æ•´åˆçš„æœ€ä½³æ—¶æœº**:
- ç”¨æˆ·æå‡ºé—®é¢˜æ˜¯é‡æ–°å®¡è§†æ¶æ„çš„å¥½æœºä¼š
- æŠ€æœ¯å€ºåŠ¡åº”è¯¥åŠæ—¶æ¸…ç†ï¼Œä¸è¦æ‹–å»¶
- å°å‹æ•´åˆï¼ˆ80è¡Œä»£ç ï¼‰é£é™©å¯æ§ï¼Œæ”¶ç›Šæ˜æ˜¾

**è‡ªåŒ…å«çš„ä»·å€¼**:
- ç®€åŒ–éƒ¨ç½²å’Œæµ‹è¯•æµç¨‹
- æé«˜ä»£ç å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§
- å¢å¼ºå›¢é˜Ÿåä½œæ•ˆç‡
- ç¬¦åˆè¡Œä¸šæœ€ä½³å®è·µ

---

## 10. é™„å½•

### 10.1 ç›¸å…³æ–‡ä»¶æ¸…å•

**ä¿®æ”¹çš„æ–‡ä»¶**:
1. `plugins/ç­¹å»ºç»„/skills/Wan/scripts/wan-base.py`
   - æ•´åˆ WanAPIManager ç±» (+80è¡Œ)
   - ç§»é™¤å¤–éƒ¨å¯¼å…¥
   - ä¼˜åŒ–è·¯å¾„æŸ¥æ‰¾é€»è¾‘

2. `plugins/ç­¹å»ºç»„/skills/canvas-design-3d-generation/README-Z4.md`
   - æ–°å¢ "3.0 æ¶æ„è¯´æ˜" ç« èŠ‚
   - è¯´æ˜è‡ªåŒ…å«è®¾è®¡ä¼˜åŠ¿
   - æä¾›æ–°çš„å¯¼å…¥ç¤ºä¾‹

3. `scripts/wan_api_manager.py`
   - æ·»åŠ  "å¯é€‰å·¥å…·" è¯´æ˜
   - æ ‡è®°ä¸ºéå¿…éœ€æ–‡ä»¶
   - ä¿ç•™ä½œä¸ºç‹¬ç«‹æµ‹è¯•å·¥å…·

**æ–°å»ºçš„æ–‡ä»¶**:
1. `reports/Wan-Skillè‡ªåŒ…å«æ¶æ„æ•´åˆæŠ¥å‘Š-20251028.md` (æœ¬æŠ¥å‘Š)

### 10.2 å…³é”®ä»£ç ç‰‡æ®µ

**æ•´åˆåçš„ wan-base.py ç»“æ„**:
```python
# æ–‡ä»¶: plugins/ç­¹å»ºç»„/skills/Wan/scripts/wan-base.py

"""é€šä¹‰ä¸‡ç›¸2.5 I2V API - E8 Image-to-Video Generation Template"""

# === å¯¼å…¥éƒ¨åˆ† ===
import requests
import json
import time
import base64
import uuid
import os  # æ–°å¢
from datetime import datetime
from pathlib import Path
from typing import Optional, Dict, Any, List
import sys
from dotenv import load_dotenv  # æ–°å¢

# === å†…ç½® API Key ç®¡ç†å™¨ ===
class WanAPIManager:
    """é€šä¹‰ä¸‡ç›¸ API Key ç®¡ç†å™¨ (å†…ç½®ç‰ˆæœ¬)"""
    def __init__(self, env_path: Optional[Path] = None):
        # è‡ªåŠ¨å‘ä¸ŠæŸ¥æ‰¾é¡¹ç›®æ ¹ç›®å½•çš„ .env
        if env_path is None:
            current_dir = Path(__file__).parent
            env_path = current_dir.parent.parent.parent.parent / '.env'

        self.env_path = env_path
        load_dotenv(self.env_path)

        self.api_key = os.getenv('ALIYUN_API_KEY') or os.getenv('DASHSCOPE_API_KEY')

        if not self.api_key:
            raise ValueError("é…ç½®é”™è¯¯: è¯·åœ¨ .env æ–‡ä»¶ä¸­è®¾ç½® DASHSCOPE_API_KEY")

    def get_headers(self) -> Dict[str, str]:
        return {
            "Authorization": f"Bearer {self.api_key}",
            "Content-Type": "application/json",
            "X-DashScope-Async": "enable"
        }

    # ... å…¶ä»–æ–¹æ³•

# === ä¸»è¦ API å®¢æˆ·ç«¯ ===
class WanAPIClient:
    """é€šä¹‰ä¸‡ç›¸2.5 I2V API å®¢æˆ·ç«¯"""
    def __init__(self, ...):
        # ä½¿ç”¨å†…ç½®çš„ WanAPIManager
        self.api_manager = WanAPIManager()  # å®Œå…¨è‡ªåŒ…å«
        # ...
```

### 10.3 éªŒè¯å‘½ä»¤

```bash
# 1. æµ‹è¯•å¯¼å…¥
python3 -c "
from pathlib import Path
import sys
import importlib.util

wan_base_path = Path('plugins/ç­¹å»ºç»„/skills/Wan/scripts/wan-base.py')
spec = importlib.util.spec_from_file_location('wan_base', wan_base_path)
wan_base = importlib.util.module_from_spec(spec)
spec.loader.exec_module(wan_base)

print('âœ… WanAPIClient:', wan_base.WanAPIClient)
print('âœ… WanAPIManager:', wan_base.WanAPIManager)
"

# 2. éªŒè¯æ— å¤–éƒ¨ä¾èµ–
grep -r "from scripts import WanAPIManager" --include="*.py" --exclude-dir=".git"
# é¢„æœŸ: æ— ç»“æœ

# 3. è¿è¡Œé›†æˆæµ‹è¯•
python plugins/ç­¹å»ºç»„/skills/canvas-design-3d-generation/test_z4_integration.py
# é¢„æœŸ: æ‰€æœ‰æ ¸å¿ƒé€»è¾‘æµ‹è¯•é€šè¿‡
```

---

**æŠ¥å‘Šç»“æŸ**

æ•´åˆæ—¶é—´: 2025-10-28
çŠ¶æ€: âœ… å®Œæˆ
å½±å“èŒƒå›´: Wan Skill æ¶æ„ä¼˜åŒ–
ç ´åæ€§å˜æ›´: æ— 
